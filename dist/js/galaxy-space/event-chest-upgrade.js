"use strict";define(["jquery","ajax","confirmPopup","eventChestInspection"],function(e,n,s,t){var c={ask:function(e,t){var i=e.level+1;n("GET","/chest/condition/level"+i,null).then(function(n){var t=n.content.content,o=t.coins,r=t.gems,a='\n          <div class="confirm-grid-upgrade-container">\n            <div class="image-block1">\n              <img class="image-block1-chest" src="https://d220xxmclrx033.cloudfront.net/event-space/img/chest/chest'+i+'.png">\n            </div>\n            <div class="content-block1">\n              <span>Lv'+e.level+" -> Lv"+i+'</span>\n            </div>\n            <div class="content-block2">\n              你確定要花費 <span class="confirm-popup-info"> '+o+'\n              <span class="confirm-popup-warning">個 e 幣</span>、 '+r+' <span class="confirm-popup-warning">個 寶石 </span></span>\n              升級至 Lv'+i+' 寶箱嗎？\n            </div>\n            <div class="content-block3">請注意： 高等的寶箱有更好的寶藏等著你，但升級寶箱有一定失敗的機率喔!</div>\n          </div>\n        ';s.dialog(a,c.process.bind(c.process,e))})},process:function(i){var o=i.level+1,r=e("#loading");r.css("display",""),n("GET","/chest/condition/level"+o,null).then(function(e){var s=e.content.content,t=s.coins,c=s.gems;return n("GET","/chest/checkBalance?coins="+t+"&gems="+c,null)}).then(function(t){var c=t.content;if(c){return s.ok("Oooooops 餘額不足喔！",c),r.css("display","none"),e.Deferred().reject().promise()}return n("PUT","/currencyBank/chest/levelUp/"+i.id)}).then(function(n){if(!t(n.message,n.content)){var i=c.determineLevelUpSuccess(n.content);s.image(i.text,i.gif,function(){var n=parseInt(e("#coins").text()),s=parseInt(e("#gems").text()),t=i.coins,c=i.gems,o=n-t,r=s-c;require(["eventChestGet","eventCountUp"],function(e,t){e(),t("coins",n,o),t("gems",s,r)})})}}).done(function(){r.css("display","none")})},determineLevelUpSuccess:function(e){var n=e[0],s=parseInt(n.memo.upLevel);return n&&"true"===n.memo.levelUpSuccess?(n.text="升級成功",n.gif='<image class="confirm-popup-chest-img" src="https://d220xxmclrx033.cloudfront.net/event-space/img/chest/upgradeStatus/upgradeSuccess'+s+'.gif">'):(n.text="升級失敗",n.gif='<image class="confirm-popup-chest-img" src="https://d220xxmclrx033.cloudfront.net/event-space/img/chest/upgradeStatus/upgradeFail'+(s-1)+'.gif">'),n}};return c});